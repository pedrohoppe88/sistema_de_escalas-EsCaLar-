<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Registrar Servi√ßo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">

<h2>üìã Registrar Servi√ßo do Dia {{ data_selecionada|date:"d/m/Y" }}</h2>
<p>Selecione apenas os militares aptos</p>

<form method="get" class="mb-3">
    <div class="row g-2 align-items-end">
        <div class="col-md-3">
            <label for="data" class="form-label">Data do Aditamento</label>
            <input type="date" id="data" name="data" class="form-control" value="{{ data_selecionada|date:'Y-m-d' }}">
        </div>
        <div class="col-md-3">
            <label class="form-label">Pesquisar por nome</label>
            <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Ex.: Jo√£o">
        </div>
        <div class="col-md-3">
            <label class="form-label">Gradua√ß√£o</label>
            <select name="graduacao" class="form-select">
                <option value="">Todas as gradua√ß√µes</option>
                {% for code,label in graduacoes %}
                    <option value="{{ code }}" {% if graduacao == code %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3 d-flex gap-2">
            <button type="submit" class="btn btn-outline-primary w-50">Pesquisar</button>
            <a href="{% url 'registrar_servico' %}?data={{ data_selecionada|date:'Y-m-d' }}" class="btn btn-outline-secondary w-50">Limpar</a>
        </div>
        <div class="col-12 mt-2">
            <a href="{% url 'aditamento_pdf_por_data' data_selecionada.year data_selecionada.month data_selecionada.day %}" class="btn btn-outline-info">
                üìÑ Gerar PDF
            </a>
        </div>
    </div>
    </form>

<form method="post">
    {% csrf_token %}
    <input type="hidden" name="data" value="{{ data_selecionada|date:'Y-m-d' }}">

    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Escalar</th>
                <th>Tipo de Servi√ßo</th>
                <th>Nome</th>
                <th>Gradua√ß√£o</th>
                <th>Dias de Folga</th>
                <th>Status</th>
                <th>Motivo</th>
            </tr>
        </thead>
        <tbody>
            {% for item in militares %}
            <tr>
                <td>
                    <input type="checkbox" name="militares" value="{{ item.militar.id }}">
                </td>
                <td>
                    <select class="form-select form-select-sm" name="tipo_{{ item.militar.id }}" {% if item.todos_ocupados %}style="background-color:#f1f3f5; color:#6c757d;" title="Todas as op√ß√µes ocupadas"{% endif %}>
                        {% for code,label in item.opcoes_tipo %}
                            <option value="{{ code }}" {% if code in tipos_ocupados %}disabled{% endif %}>
                                {{ label }}{% if code in tipos_ocupados %} ‚Äî j√° escalado{% endif %}
                            </option>
                        {% endfor %}
                    </select>
                </td>
                <td>{{ item.militar.nome }}</td>
                <td>{{ item.militar.graduacao }}</td>
                <td>{{ item.dias_folga }}</td>
                <td>
                    {% if item.status == 'ALTA' %}
                        <span class="badge bg-success">ALTA</span>
                    {% elif item.status == 'NORMAL' %}
                        <span class="badge bg-warning text-dark">NORMAL</span>
                    {% else %}
                        <span class="badge bg-danger">BAIXA</span>
                    {% endif %}
                </td>
                <td>{{ item.motivo }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">Nenhum militar apto na data selecionada</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <button type="submit" class="btn btn-primary">
        ‚úÖ Registrar Servi√ßo
    </button>

    <a href="{% url 'ver_efetivo' %}" class="btn btn-secondary">
        ‚Ü© Voltar
    </a>
    <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">
        ‚Ü© Voltar ao Dashboard
    </a>
</form>

<hr class="my-4">

<h3>üö´ N√£o Aptos (informativo)</h3>
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Nome</th>
            <th>Gradua√ß√£o</th>
            <th>Dias de Folga</th>
            <th>Status</th>
            <th>Motivo</th>
        </tr>
    </thead>
    <tbody>
        {% for item in nao_aptos %}
        <tr class="table-danger">
            <td>{{ item.militar.nome }}</td>
            <td>{{ item.militar.graduacao }}</td>
            <td>
                {% if item.dias_folga is not None %}
                    {{ item.dias_folga }}
                {% else %}
                    ‚Äî
                {% endif %}
            </td>
            <td>
                {% if item.status == 'J√Å ESCALADO' %}
                    <span class="badge bg-secondary">J√Å ESCALADO</span>
                {% else %}
                    <span class="badge bg-danger">{{ item.status }}</span>
                {% endif %}
            </td>
            <td>{{ item.motivo }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5">Nenhum militar n√£o apto na data selecionada</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

</body>
</html>
